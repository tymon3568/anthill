# Upstream Service Definitions
# Defines backend services for load balancing and health checks

# User Service (Authentication & User Management)
upstream user_service {
    least_conn;
    server user-service:8000 max_fails=3 fail_timeout=30s;
    keepalive 32;
}

# User Service Metrics (Prometheus format)
upstream user_service_metrics {
    server user-service:9090;
}

# Inventory Service (Product & Inventory Management)
upstream inventory_service {
    least_conn;
    server inventory-service:8001 max_fails=3 fail_timeout=30s;
    keepalive 32;
}

# Order Service (Order Processing & Management)
upstream order_service {
    least_conn;
    server order-service:8002 max_fails=3 fail_timeout=30s;
    keepalive 32;
}

# Payment Service (Payment Processing)
upstream payment_service {
    least_conn;
    server payment-service:8003 max_fails=3 fail_timeout=30s;
    keepalive 32;
}

# Integration Service (External API Integrations)
upstream integration_service {
    least_conn;
    server integration-service:8004 max_fails=3 fail_timeout=30s;
    keepalive 32;
}

# Kanidm Identity Provider (OAuth2/OIDC)
upstream kanidm {
    server kanidm:8300;
}

# MinIO Object Storage
upstream minio {
    server minio:9000;
}

# Redis Cache
upstream redis {
    server redis:6379;
}

# NATS Message Queue
upstream nats {
    server nats:4222;
}

# PostgreSQL Database (for direct access if needed)
upstream postgres {
    server postgres:5432;
}
