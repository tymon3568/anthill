{
  "db_name": "PostgreSQL",
  "query": "\n                    INSERT INTO inventory_valuations (\n                        tenant_id, product_id, valuation_method,\n                        current_unit_cost, total_quantity, total_value\n                    )\n                    VALUES ($1, $2, 'fifo', $3, $4, $5)\n                    ON CONFLICT (tenant_id, product_id)\n                    DO UPDATE SET\n                        current_unit_cost = CASE\n                            WHEN inventory_valuations.total_quantity + $4 = 0 THEN 0\n                            ELSE CAST((inventory_valuations.total_value + $5) AS DECIMAL) / NULLIF(inventory_valuations.total_quantity + $4, 0)\n                        END,\n                        total_quantity = inventory_valuations.total_quantity + $4,\n                        total_value = inventory_valuations.total_value + $5,\n                        last_updated = NOW(),\n                        updated_by = $6\n                    ",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": [
        "Uuid",
        "Uuid",
        "Int8",
        "Int8",
        "Int8",
        "Uuid"
      ]
    },
    "nullable": []
  },
  "hash": "7646cc9a36fe1985d8eb1958896eeebe5faeb83412a1b56adf5dbf30b2f02bd9"
}
